<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; background: #000; color: white; height: 100vh; overflow: hidden; font-family: sans-serif; display: flex; flex-direction: column; }
        #vp { flex: 1; position: relative; background: #111; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        canvas { position: absolute; touch-action: none; z-index: 1; image-rendering: pixelated; }
        .nav { height: 85px; background: #151515; display: flex; justify-content: space-around; align-items: center; z-index: 3000; border-top: 1px solid #444; padding-bottom: 10px; }
        .btn { padding: 12px; background: #222; border: 1px solid #555; color: white; font-size: 11px; border-radius: 8px; font-weight: bold; }
        .panel { position: absolute; bottom: 100px; width: 92%; left: 4%; background: #1a1a1a; border-radius: 12px; padding: 15px; display: none; z-index: 3100; border: 1px solid #00ff64; box-sizing: border-box; }
        #gal, #samp { display: flex; gap: 10px; overflow-x: auto; margin-top: 10px; min-height: 70px; border-top: 1px solid #333; padding-top: 10px; }
        .tmb { width: 60px; height: 60px; border: 1px solid #555; background-size: cover; flex-shrink: 0; border-radius: 4px; }
        .lbl { font-size: 10px; color: #888; margin-top: 10px; text-transform: uppercase; }
    </style>
</head>
<body>
    <div id="vp"><canvas id="bc"></canvas><canvas id="ec"></canvas></div>
    
    <div id="mP" class="panel">
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <button class="btn" onclick="UI.up()">IMPORT PIC</button>
            <button class="btn" onclick="DB.save()" style="border-color:#00ff64">SAVE TO VAULT</button>
        </div>
        
        <div class="lbl">Your Vault (No 5MB Limit)</div>
        <div id="gal"></div>
        
        <div class="lbl">Sample Gallery</div>
        <div id="samp">
            <div class="tmb" style="background-image:url('https://picsum.photos/id/237/200')" onclick="UI.loadSample('https://picsum.photos/id/237/800')"></div>
            <div class="tmb" style="background-image:url('https://picsum.photos/id/15/200')" onclick="UI.loadSample('https://picsum.photos/id/15/800')"></div>
            <div class="tmb" style="background-image:url('https://picsum.photos/id/10/200')" onclick="UI.loadSample('https://picsum.photos/id/10/800')"></div>
        </div>
    </div>

    <div class="nav">
        <button class="btn" onclick="UI.tog()">MENU</button>
        <button id="eB" class="btn" onclick="UI.edit()">EDIT OFF</button>
        <button class="btn" onclick="location.reload()">RELOAD</button>
    </div>

<script>
const DB = {
    db: null,
    init() {
        let r = indexedDB.open("PicVault", 1);
        r.onupgradeneeded = e => e.target.result.createObjectStore("pics", {autoIncrement:true});
        r.onsuccess = e => { this.db = e.target.result; this.render(); };
    },
    save() {
        let ec = document.getElementById('ec');
        let d = ec.toDataURL();
        let tx = this.db.transaction("pics", "readwrite").objectStore("pics").add(d);
        tx.onsuccess = () => this.render();
    },
    render() {
        let g = document.getElementById('gal'); g.innerHTML = '';
        this.db.transaction("pics").objectStore("pics").openCursor().onsuccess = e => {
            let cursor = e.target.result;
            if (cursor) {
                let img = document.createElement('div'); img.className = 'tmb';
                img.style.backgroundImage = `url(${cursor.value})`;
                img.onclick = () => UI.loadToCanvas(cursor.value);
                g.prepend(img); cursor.continue();
            }
        };
    }
};

const UI = {
    mode: 'pan',
    tog() { let p = document.getElementById('mP'); p.style.display = p.style.display === 'block' ? 'none' : 'block'; },
    edit() { 
        this.mode = this.mode === 'pan' ? 'draw' : 'pan'; 
        document.getElementById('eB').innerText = this.mode === 'pan' ? 'EDIT OFF' : 'EDIT ON';
        document.getElementById('eB').style.color = this.mode === 'pan' ? 'white' : '#00ff64';
    },
    up() {
        let i = document.createElement('input'); i.type = 'file';
        i.onchange = e => {
            let reader = new FileReader();
            reader.onload = event => this.loadSample(event.target.result);
            reader.readAsDataURL(e.target.files[0]);
        };
        i.click();
    },
    loadSample(url) {
        let img = new Image();
        img.crossOrigin = "anonymous";
        img.onload = () => {
            let bc = document.getElementById('bc'), ec = document.getElementById('ec');
            bc.width = ec.width = img.width; bc.height = ec.height = img.height;
            bc.getContext('2d').drawImage(img, 0, 0);
            this.tog(); // Close menu
        };
        img.src = url;
    },
    loadToCanvas(data) {
        let img = new Image();
        img.onload = () => document.getElementById('ec').getContext('2d').drawImage(img, 0, 0);
        img.src = data;
        this.tog();
    }
};

DB.init();
</script>
</body>
</html>

