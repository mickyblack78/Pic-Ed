<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Retoucher Pro Fluoro â€“ Fixed</title>

<style>
:root {
    --bg:#000;
    --glass:rgba(15,15,15,0.98);
    --fluoro:#00ff66;
    --glow:0 0 20px #00ff66;
    --ui-font:Inter,sans-serif;
}

* {
    box-sizing:border-box;
    -webkit-tap-highlight-color:transparent;
}

body {
    margin:0;
    padding:0;
    background:var(--bg);
    font-family:var(--ui-font);
    width:100vw;
    height:100vh;
}

#viewer {
    position:relative;
    width:100vw;
    height:100vh;
    overflow:hidden;
    background:#0a0a0a;
}

canvas {
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
}

#mainLayer { z-index:2; }
#drawLayer { z-index:3; pointer-events:none; }

.dock {
    position:fixed;
    bottom:20px;
    left:50%;
    margin-left:-160px;
    width:320px;
    display:flex;
    gap:8px;
    padding:10px;
    background:var(--glass);
    border-radius:28px;
    border:1px solid rgba(0,255,102,0.3);
    justify-content:center;
    z-index:10000;
    transform-origin:bottom center;
}

.box {
    width:60px;
    height:60px;
    border-radius:18px;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    font-size:9px;
    font-weight:900;
    color:#fff;
    background:rgba(255,255,255,0.05);
    cursor:pointer;
    border:1.5px solid transparent;
    transition:0.2s;
}

.box.active {
    border-color:var(--fluoro);
    color:var(--fluoro);
    box-shadow:var(--glow);
}

.panel {
    position:fixed;
    bottom:110px;
    left:50%;
    margin-left:-160px;
    width:320px;
    padding:15px;
    background:var(--glass);
    border-radius:24px;
    border:1px solid var(--fluoro);
    display:none;
    flex-direction:column;
    gap:12px;
    z-index:9999;
    transform-origin:bottom center;
}

.panel.open { display:flex; }

.grid-3 {
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:8px;
}

.btn {
    padding:12px;
    background:rgba(255,255,255,0.1);
    border-radius:12px;
    font-size:10px;
    font-weight:bold;
    color:#fff;
    border:1px solid transparent;
    text-align:center;
    cursor:pointer;
}

.btn.active {
    border-color:var(--fluoro);
    color:var(--fluoro);
    box-shadow:var(--glow);
}

.thumb {
    width:45px;
    height:45px;
    border:1.5px solid var(--fluoro);
    background:#000;
    object-fit:contain;
}
</style>
</head>

<body>

<div id="viewer">
    <canvas id="mainLayer"></canvas>
    <canvas id="drawLayer"></canvas>
</div>

<div class="panel" id="tools-panel">
    <div class="grid-3">
        <div class="btn t-btn" id="cut" onclick="toggleT('cut')">CUT</div>
        <div class="btn t-btn" id="copy" onclick="toggleT('copy')">COPY</div>
        <div class="btn" onclick="undo()">UNDO</div>
    </div>
</div>

<div class="dock">
    <div class="box" onclick="toggleP('tools-panel')">TOOLS</div>
</div>

<script>
const m = document.getElementById('mainLayer');
const d = document.getElementById('drawLayer');
const mctx = m.getContext('2d');
const dctx = d.getContext('2d');

m.width = d.width = innerWidth * 2;
m.height = d.height = innerHeight * 2;
mctx.lineCap = dctx.lineCap = 'round';

let cfg = {
    tool:null,
    color:'#00ff66',
    size:20,
    path:[],
    clip:null,
    pasting:false,
    history:[]
};

let isDrawing=false;
let lx=0, ly=0;

function toggleP(id){
    document.querySelectorAll('.panel').forEach(p=>p.classList.remove('open'));
    document.getElementById(id).classList.add('open');
}

function toggleT(t){
    cfg.tool = cfg.tool === t ? null : t;
    document.querySelectorAll('.t-btn').forEach(b=>{
        b.classList.toggle('active', b.id === cfg.tool);
    });
}

function commitHistory(){
    cfg.history.push(mctx.getImageData(0,0,m.width,m.height));
}

window.addEventListener('touchstart',e=>{
    if(!cfg.tool) return;
    e.preventDefault();
    const r=d.getBoundingClientRect();
    lx=(e.touches[0].clientX-r.left)*(d.width/r.width);
    ly=(e.touches[0].clientY-r.top)*(d.height/r.height);
    cfg.path=[{x:lx,y:ly}];
    isDrawing=true;
},{passive:false});

window.addEventListener('touchmove',e=>{
    if(!isDrawing) return;
    e.preventDefault();
    const r=d.getBoundingClientRect();
    const nx=(e.touches[0].clientX-r.left)*(d.width/r.width);
    const ny=(e.touches[0].clientY-r.top)*(d.height/r.height);

    dctx.clearRect(0,0,d.width,d.height);
    dctx.strokeStyle=cfg.color;
    dctx.lineWidth=2;
    dctx.setLineDash([5,5]);

    dctx.beginPath();
    dctx.moveTo(cfg.path[0].x,cfg.path[0].y);
    cfg.path.forEach(p=>dctx.lineTo(p.x,p.y));
    dctx.lineTo(nx,ny);
    dctx.stroke();

    cfg.path.push({x:nx,y:ny});
},{passive:false});

window.addEventListener('touchend',()=>{
    if(cfg.tool==='cut'||cfg.tool==='copy'){
        const temp=document.createElement('canvas');
        temp.width=d.width;
        temp.height=d.height;
        const tctx=temp.getContext('2d');

        tctx.beginPath();
        cfg.path.forEach((p,i)=>i?tctx.lineTo(p.x,p.y):tctx.moveTo(p.x,p.y));
        tctx.closePath();
        tctx.clip();
        tctx.drawImage(m,0,0);

        cfg.clip=tctx.getImageData(0,0,temp.width,temp.height);

        if(cfg.tool==='cut'){
            mctx.save();
            mctx.beginPath();
            cfg.path.forEach((p,i)=>i?mctx.lineTo(p.x,p.y):mctx.moveTo(p.x,p.y));
            mctx.closePath();
            mctx.clip();
            mctx.clearRect(0,0,m.width,m.height);
            mctx.restore();
        }

        commitHistory();
    }

    dctx.clearRect(0,0,d.width,d.height);
    isDrawing=false;
});

function undo(){
    if(cfg.history.length){
        mctx.putImageData(cfg.history.pop(),0,0);
    }
}
</script>

</body>
</html>
