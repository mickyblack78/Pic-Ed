<!DOCTYPE html>
<html>
<head>
    <title>31488_CORE_LOCKED</title>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; margin: 0; overflow: hidden; }
        #mon { height: 90vh; padding: 20px; overflow-y: auto; font-size: 12px; border-bottom: 1px solid #040; }
        .row { display: grid; grid-template-columns: 80px 120px 1fr; border-bottom: 1px solid #111; }
        #stat { height: 10vh; padding: 10px; display: flex; justify-content: space-around; font-size: 11px; background: #050505; }
        .f-id { color: #f0f; }
    </style>
</head>
<body>
    <div id="mon"></div>
    <div id="stat">
        <span>LOGIC: 31,488</span>
        <span>REGISTRY: 513 NODES</span>
        <span>FIX_ARRAY: 1-34 ACTIVE</span>
        <span>SYNC: HARD-THREADED</span>
    </div>

<script id="worker-logic" type="javascript/worker">
    // --- THIS IS THE RAW 31,488 LOGIC CORE ---
    let registry = new Float64Array(513);
    let deltas = new Float64Array(513);
    let zoom = 1.0;

    self.onmessage = function() {
        // Fix 3 & 32: High-Resolution Heartbeat
        setInterval(() => {
            zoom = 1.0 + (Math.sin(Date.now() / 500) * 0.1);
            
            for (let i = 0; i < 513; i++) {
                const old = registry[i];
                // Original 513 Logic Foundation
                let v = (Math.random() * 500) * (i / 5) * zoom;
                
                // Fix 34: Range Limit (Hard Mask)
                if (v > 9500) v = 9500;
                if (v < 0) v = 0;

                // Fix 30: Delta Check
                registry[i] = v;
                deltas[i] = v - old;
            }

            // Fix 26: Batch Sort (Find high-volatility nodes)
            let indices = Array.from({length: 513}, (_, i) => i);
            indices.sort((a, b) => Math.abs(deltas[b]) - Math.abs(deltas[a]));
            
            self.postMessage({
                reg: registry.slice(0, 513),
                dlt: deltas.slice(0, 513),
                idx: indices.slice(0, 20)
            });
        }, 16); // Fix 15: 60Hz Sync
    };
</script>

<script>
    // --- UI THREAD (FIX 31 & 33) ---
    const blob = new Blob([document.getElementById('worker-logic').textContent], {type: 'text/javascript'});
    const worker = new Worker(window.URL.createObjectURL(blob));
    const mon = document.getElementById('mon');

    worker.onmessage = function(e) {
        // Fix 31: Garbage Collection (Buffer Flush)
        mon.innerHTML = '';
        const frag = document.createDocumentFragment();

        e.data.idx.forEach(i => {
            const r = document.createElement('div');
            r.className = 'row';
            r.innerHTML = `<span class="f-id">N_${i}</span><span>V: ${e.data.reg[i].toFixed(2)}</span><span>D: ${e.data.dlt[i].toFixed(2)}</span>`;
            frag.appendChild(r);
        });
        mon.appendChild(frag);
    };

    // Fix 21: Environment Handshake
    console.log("31,488 UNIT DEPLOYED.");
    worker.postMessage('start');
</script>
</body>
</html>
