<!DOCTYPE html>
<html>
<head>
    <style>
        body { margin: 0; overflow: hidden; background: #222; font-family: sans-serif; }
        canvas { display: block; background: white; cursor: crosshair; }
        .panel { position: fixed; background: rgba(50,50,50,0.9); color: white; padding: 10px; border-radius: 8px; display: flex; flex-direction: column; gap: 10px; }
        #paintPanel { top: 10px; left: 10px; width: 150px; }
        #menuPanel { top: 10px; right: 10px; width: 200px; }
        #actionPanel { bottom: 10px; left: 50%; transform: translateX(-50%); flex-direction: row; }
        .box { width: 30px; height: 30px; border: 1px solid #000; cursor: pointer; }
        .active { outline: 3px solid #0ff; }
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; }
        .thumb { width: 2cm; height: 2cm; background: #eee; position: relative; border: 1px solid #444; }
        .del { position: absolute; top: 0; right: 0; background: red; color: white; font-size: 10px; cursor: pointer; border: none; }
        label { font-size: 12px; }
        input[type="range"] { width: 100%; }
    </style>
</head>
<body>

<canvas id="c"></canvas>

<div id="paintPanel" class="panel">
    <div id="paintBox" class="box" style="background: #000; width: 100%;"></div>
    <label>Color</label>
    <input type="range" id="rainbow" min="0" max="360" oninput="updateHue(this.value)">
    <div id="shades" class="grid"></div>
    <label>Brush Size</label>
    <input type="range" id="size" min="1" max="100" value="5" oninput="brushSize = this.value">
    <label>Transparency</label>
    <input type="range" id="alpha" min="0" max="100" value="100" oninput="brushOpacity = this.value/100">
</div>

<div id="menuPanel" class="panel">
    <button onclick="saveDrawing()">Save Drawing</button>
    <button onclick="document.getElementById('imp').click()">Import</button>
    <input type="file" id="imp" hidden onchange="doImport(event)">
    <button onclick="doExport()">Export</button>
    <div id="thumbGrid" class="grid" style="grid-template-columns: 1fr 1fr;"></div>
</div>

<div id="actionPanel" class="panel">
    <button id="drawBtn" onclick="toggleTool('draw')">Draw</button>
    <button id="pickBtn" onclick="toggleTool('pick')">Picker</button>
</div>

<script>
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');
    canvas.width = 5000; canvas.height = 5000;

    let drawing = false, currentTool = null, brushSize = 5, brushOpacity = 1, activeColor = '#000000';

    // Toggle logic
    function toggleTool(tool) {
        const btn = document.getElementById(tool + 'Btn');
        if (currentTool === tool) {
            currentTool = null;
            btn.classList.remove('active');
        } else {
            document.querySelectorAll('.panel button').forEach(b => b.classList.remove('active'));
            currentTool = tool;
            btn.classList.add('active');
        }
    }

    canvas.onmousedown = (e) => {
        if (currentTool === 'pick') {
            const data = ctx.getImageData(e.pageX + window.scrollX, e.pageY + window.scrollY, 1, 1).data;
            const hex = "#" + ((1 << 24) + (data[0] << 16) + (data[1] << 8) + data[2]).toString(16).slice(1);
            updateColor(hex);
            return;
        }
        drawing = true;
        ctx.beginPath();
        ctx.moveTo(e.pageX + window.scrollX, e.pageY + window.scrollY);
    };

    canvas.onmousemove = (e) => {
        if (!drawing || currentTool !== 'draw') return;
        ctx.lineWidth = brushSize;
        ctx.globalAlpha = brushOpacity;
        ctx.strokeStyle = activeColor;
        ctx.lineCap = 'round';
        ctx.lineTo(e.pageX + window.scrollX, e.pageY + window.scrollY);
        ctx.stroke();
    };

    canvas.onmouseup = () => { drawing = false; ctx.closePath(); };

    function updateColor(hex) {
        activeColor = hex;
        document.getElementById('paintBox').style.backgroundColor = hex;
    }

    function updateHue(h) {
        const color = `hsl(${h}, 100%, 50%)`;
        updateColor(color);
        const shades = document.getElementById('shades');
        shades.innerHTML = '';
        for(let i=1; i<=10; i++) {
            const s = document.createElement('div');
            s.className = 'box';
            s.style.background = `hsl(${h}, 100%, ${i*10}%)`;
            s.onclick = () => updateColor(s.style.background);
            shades.appendChild(s);
        }
    }

    function doImport(e) {
        const r = new FileReader();
        r.onload = (ev) => {
            const i = new Image();
            i.onload = () => {
                const s = (window.innerWidth * 0.8) / i.width;
                const w = i.width * s, h = i.height * s;
                const x = window.scrollX + (window.innerWidth - w) / 2;
                const y = window.scrollY + (window.innerHeight - h) / 2;
                ctx.globalAlpha = 1;
                ctx.drawImage(i, x, y, w, h);
                ctx.globalAlpha = brushOpacity;
            };
            i.src = ev.target.result;
        };
        r.readAsDataURL(e.target.files[0]);
    }

    function doExport() {
        const l = document.createElement('a');
        l.download = 'art.png';
        l.href = canvas.toDataURL();
        l.click();
    }

    function saveDrawing() {
        const grid = document.getElementById('thumbGrid');
        const t = document.createElement('div');
        t.className = 'thumb';
        const img = new Image();
        img.src = canvas.toDataURL();
        img.style.width = "100%";
        t.appendChild(img);
        const d = document.createElement('button');
        d.className = 'del'; d.innerText = 'X';
        d.onclick = () => t.remove();
        t.appendChild(d);
        grid.appendChild(t);
    }
    
    updateHue(0);
</script>
</body>
</html>
