<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PicEd 5.1</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: sans-serif; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        #vp { flex: 1; position: relative; background: #111; overflow: hidden; }
        canvas { position: absolute; touch-action: none; background: #222; }
        .nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: #1a1a1a; display: flex; justify-content: center; align-items: center; z-index: 9999; border-top: 1px solid #444; }
        .btn { padding: 12px 25px; background: #444; color: #fff; border: 1px solid #666; border-radius: 5px; font-weight: bold; margin: 0 10px; }
        .panel { position: fixed; bottom: 80px; left: 10px; right: 10px; background: #222; padding: 15px; display: none; z-index: 10000; border: 1px solid #555; border-radius: 10px; }
        #gal { display: flex; gap: 10px; overflow-x: auto; min-height: 60px; margin-bottom: 15px; padding-bottom: 5px; }
        .tmb { width: 65px; height: 65px; border: 1px solid #fff; background-size: cover; flex-shrink: 0; }
        #upBtn { background: #335533; z-index: 10001; }
    </style>
</head>
<body>
    <div id="vp"><canvas id="bc"></canvas></div>
    <div id="mP" class="panel">
        <div id="gal"></div>
        <button id="upBtn" class="btn" onclick="UI.up()">Import New</button>
        <button class="btn" onclick="DB.save()">Save to Vault</button>
    </div>
    <div class="nav">
        <button class="btn" onclick="UI.tog('mP')">Open Vault</button>
    </div>
<script>
const DB = {
    db: null,
    init() {
        let r = indexedDB.open("PicVault", 1);
        r.onupgradeneeded = e => e.target.result.createObjectStore("pics", {autoIncrement:true});
        r.onsuccess = e => { this.db = e.target.result; this.render(); };
    },
    save() {
        if(!Engine.bc.width) return;
        let tx = this.db.transaction("pics", "readwrite");
        tx.objectStore("pics").add(Engine.bc.toDataURL());
        tx.oncomplete = () => { this.render(); alert("Saved!"); };
    },
    render() {
        let g = document.getElementById('gal'); g.innerHTML = '';
        this.db.transaction("pics").objectStore("pics").openCursor().onsuccess = e => {
            let cur = e.target.result;
            if (cur) {
                let d = document.createElement('div'); d.className = 'tmb';
                d.style.backgroundImage = `url(${cur.value})`;
                d.onclick = () => UI.load(cur.value);
                g.prepend(d); cur.continue();
            }
        };
    }
};
const UI = {
    tog(id) { let p = document.getElementById(id); p.style.display = p.style.display==='block'?'none':'block'; },
    up() {
        let i = document.createElement('input'); i.type = 'file';
        i.onchange = e => {
            let r = new FileReader();
            r.onload = ev => this.load(ev.target.result);
            r.readAsDataURL(e.target.files[0]);
        };
        i.click();
    },
    load(data) {
        let img = new Image();
        img.onload = () => { Engine.setup(img); this.tog('mP'); };
        img.src = data;
    }
};
const Engine = {
    bc: document.getElementById('bc'), btx: null, ox: 0, oy: 0,
    setup(img) {
        this.bc.width = img.width; this.bc.height = img.height;
        this.btx.drawImage(img, 0, 0);
        this.ox = (window.innerWidth - img.width) / 2;
        this.oy = (window.innerHeight - img.height) / 2;
        this.update();
    },
    update() { this.bc.style.transform = `translate(${this.ox}px, ${this.oy}px)`; },
    init() { this.btx=this.bc.getContext('2d'); DB.init(); }
};
let sx, sy, bx, by;
window.addEventListener('touchstart', e => {
    if(e.target.closest('.nav') || e.target.closest('.panel')) return;
    sx = e.touches[0].clientX; sy = e.touches[0].clientY;
    bx = Engine.ox; by = Engine.oy;
});
window.addEventListener('touchmove', e => {
    if(e.target.closest('.nav') || e.target.closest('.panel')) return;
    Engine.ox = bx + (e.touches[0].clientX - sx);
    Engine.oy = by + (e.touches[0].clientY - sy);
    Engine.update();
}, {passive: false});
Engine.init();
</script>
</body>
</html>

        
